// Generated by CoffeeScript 1.4.0

/*
  Class: SchemaInitializer

  Responsible for initializing the dojodatabase and exposing both the drivers
  and graph to the client.
*/


(function() {
  var Database, SchemaInitializer;

  Database = require("database");

  SchemaInitializer = (function() {

    function SchemaInitializer(schemaGetter, pluginGetter, dbSettingsGetter) {
      this._sGetter = schemaGetter;
      this._pGetter = pluginGetter;
      this._dbSettingsGetter = dbSettingsGetter;
    }

    SchemaInitializer.prototype.init = function(clbk) {
      var plugin, pluginName, _db, _dbSettings, _plugins,
        _this = this;
      _plugins = this._pGetter.get();
      _dbSettings = this._dbSettingsGetter.get().init(process.env.NODE_ENV);
      _db = new Database(this._sGetter.path, this._dbSettings.path);
      for (pluginName in _plugins) {
        plugin = _plugins[pluginName];
        _db.registerPlugin(pluginName, plugin);
      }
      return _db.connect(function(err, criscoDatabase) {
        if (err != null) {
          console.error("Some error handler here");
          return clbk(err);
        } else {
          _this._criscoDatabase = criscoDatabase;
          return clbk(null);
        }
      });
    };

    SchemaInitializer.prototype.__defineGetter__('database', function() {
      return this._criscoDatabase;
    });

    return SchemaInitializer;

  })();

  module.exports = SchemaInitializer;

}).call(this);
